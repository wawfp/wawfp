!function(i){function e(i,e){this.options=i,this.marker=e,this.isOpen=i.isOpen||!1,this.opts=o}var t=null,o=null;(e.prototype=new BMap.Overlay).initialize=function(){var e=this.opts,o=e.menus,n=e.width,r=e.radius,a=2*r,s="uiPieMenu_"+((new Date).getTime()+Math.floor(1e3*Math.random())),d='<div id="'+s+'" class="ui-pie-menu">';o.length<1||(i.each(o,function(i,e){var t=e.href?e.href:"javascript:void(0);",o=e.target?e.target:"_self";d+='<a class="ui-pie-menu-item" href="'+t+'" title="'+e.title+'" target="'+o+'"><img src="'+e.icon+'" class="icon-img"/></a>'}),d+="</div>",this.dom=i(d).get(0),t.getPanes().markerPane.appendChild(this.dom),i("#"+s).css({width:a,height:a,position:"absolute",marginLeft:-r,marginTop:-r,"-webkit-border-radius":"50%","-moz-border-radius":"50%","-ms-border-radius":"50%","-o-border-radius":"50%",borderRadius:"50%",border:e.border}).find(".ui-pie-menu-item").css({width:n,height:n,lineHeight:n+"px",backgroundColor:e.bgColor,display:"block","-webkit-border-radius":"50%","-moz-border-radius":"50%","-ms-border-radius":"50%","-o-border-radius":"50%",borderRadius:"50%",textAlign:"center",position:"absolute",top:" 50%",left:"50%",marginLeft:-n/2,marginTop:-n/2,textDecoration:"none"}).find(".icon-img").css({border:"none","-webkit-border-radius":"50%","-moz-border-radius":"50%","-ms-border-radius":"50%","-o-border-radius":"50%",borderRadius:"50%"}),this.eventBind())},e.prototype.draw=function(){var e=this.opts,o=this.options,n=12,r=this.point={lng:o.lng,lat:o.lat},a=t.pointToOverlayPixel(r);e.icon&&e.icon.url&&(n=0),i(this.dom).css({left:a.x,top:a.y-n,opacity:0}),this.isOpen&&this.show()},e.prototype.show=function(){var e=this.opts,t=e.menus.length,o="semicircle"===e.type?180:360,n="semicircle"===e.type?t-1:t,r=Math.floor(o/n),a=e.radius,s=i(this.dom),d=s.find(".ui-pie-menu-item"),p=e.time;s.stop(!0).animate({opacity:1},p),i.each(d,function(e,t){var o=e*r*Math.PI/180,n=Math.floor(a+a*Math.cos(o)),s=Math.floor(a-a*Math.sin(o));i(this).stop(!0).animate({left:n,top:s,opacity:1},p)}),this.isOpen=!0},e.prototype.hide=function(){var e=this.opts,t=e.time,o=i(this.dom),n=e.width/2;o.stop(!0).animate({opacity:0},t).find(".ui-pie-menu-item").stop(!0).animate({left:"50%",top:"50%",marginLeft:-n,marginTop:-n,opacity:0},t),this.isOpen=!1},e.prototype.eventBind=function(){var e=this.opts,t=this,o=i(this.dom).find(".ui-pie-menu-item"),n=e.menus,r=e.close,a=(this.options,{});this.marker.onclick=function(){t.isOpen?t.hide():t.show()},i.each(n,function(e,n){n.href&&"javascript:void(0);"!=n.href||n.cb&&"function"==typeof n.cb&&o.eq(e).off("click").on("click",function(){a.id=n.id,a.point=t.point,n.cb(i(this),a),r&&t.hide()})})};var n=function(i){this.init(i)};n.prototype={init:function(e){var t={id:"",centerPoint:{lng:0,lat:0},level:15,type:"circle",Maptype:[],zoom:!1,close:!0,time:400,points:[],width:30,bgColor:"#fff",radius:80,border:"2px dashed red",menus:[]};o=i.extend(!0,{},t,e),this.renderMap()},renderMap:function(){var i=o.id,e=o.centerPoint,n=o.level;(t=new BMap.Map(i)).centerAndZoom(new BMap.Point(e.lng,e.lat),n),this.addControl()},addControl:function(){var i=o.Maptype,e=o.zoom;if(t.addControl(new BMap.NavigationControl),t.addControl(new BMap.ScaleControl),t.addControl(new BMap.OverviewMapControl),e&&t.enableScrollWheelZoom(!0),i.length>0){var n=this.getMapType(i);t.addControl(new BMap.MapTypeControl({mapTypes:n}))}this.createMarker()},getMapType:function(e){var t=[],o={"地图":BMAP_NORMAL_MAP,"卫星":BMAP_SATELLITE_MAP,"三维":BMAP_PERSPECTIVE_MAP};return i.each(e,function(i,e){e in o&&t.push(o[e])}),t},createMarker:function(){var e=this,n=o.points,r=o.icon;n.lenth<1||i.each(n,function(i,o){var n=new BMap.Point(o.lng,o.lat),a=new BMap.Marker(n);r&&r.url&&(a=new BMap.Marker(n,{icon:new BMap.Icon(r.url,new BMap.Size(r.width,r.height))})),t.addOverlay(a),e.renderPieMenu(o,a)})},renderPieMenu:function(i,o){var n=new e(i,o);t.addOverlay(n)}},window.MapPieMenu=n}(jQuery);